<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vive l'Empereur — Rivoli</title>
  <link rel="stylesheet" href="/src/styles.css">
</head>
<body>
  <div id="game" class="game">
    <header class="battle-header">
      <div class="header-left">
        <span class="phase-label" id="phase-label">PHASE 1: THE LINE</span>
        <span class="turn-counter" id="turn-counter">Turn 1</span>
      </div>
      <div class="header-center">
        <span class="battle-title">Battle of Rivoli — 14 January 1797</span>
      </div>
      <div class="header-right">
        <span class="weather" id="weather">Cold &amp; Clear</span>
        <span class="time" id="time-of-day">Dawn</span>
        <button class="char-btn journal-btn" id="btn-journal" title="Battle Journal">&#128214;</button>
        <button class="char-btn mute-btn" id="btn-mute" title="Toggle Music">&#9835;</button>
        <button class="char-btn" id="btn-character" title="Character &amp; Inventory">&#9776;</button>
        <button class="char-btn dev-btn" id="btn-devtools" title="Dev Tools">&#9881;</button>
      </div>
    </header>

    <main class="battle-main">
      <!-- LEFT: Player Condition + The Line -->
      <aside class="panel panel-left" id="player-panel">
        <h2>Your Condition</h2>

        <!-- Morale meter -->
        <div class="meter-group">
          <div class="meter-header">
            <span class="meter-label">Morale</span>
            <span class="meter-value"><span id="morale-num">100</span> / 100</span>
          </div>
          <div class="meter-track"><div class="meter-fill morale-fill" id="morale-bar"></div></div>
          <div class="meter-state" id="morale-state">STEADY</div>
        </div>

        <!-- Health meter -->
        <div class="meter-group">
          <div class="meter-header">
            <span class="meter-label">Health</span>
            <span class="meter-value"><span id="health-num">100</span> / 100</span>
          </div>
          <div class="meter-track"><div class="meter-fill health-fill" id="health-bar"></div></div>
          <div class="meter-state" id="health-state">UNHURT</div>
        </div>

        <!-- Fatigue meter -->
        <div class="meter-group">
          <div class="meter-header">
            <span class="meter-label">Fatigue</span>
            <span class="meter-value"><span id="fatigue-num">100</span> / 100</span>
          </div>
          <div class="meter-track"><div class="meter-fill fatigue-fill" id="fatigue-bar"></div></div>
          <div class="meter-state" id="fatigue-state">FRESH</div>
        </div>

        <div class="status-row">
          <span class="status-key">Musket</span>
          <span class="status-val" id="musket-status">Loaded</span>
        </div>

        <!-- The Line -->
        <div class="line-section">
          <h3>The Line</h3>
          <div class="officer-card" id="officer-card">
            <span class="officer-rank" id="officer-rank">Capt. Leclerc</span>
            <span class="officer-status" id="officer-status">Mounted, steady</span>
          </div>
          <div class="neighbour" id="left-neighbour">
            <span class="neighbour-name">Pierre</span>
            <span class="neighbour-state">STEADY</span>
          </div>
          <div class="you-marker" id="you-marker">[ YOU ]</div>
          <div class="neighbour" id="right-neighbour">
            <span class="neighbour-name">Jean-Baptiste</span>
            <span class="neighbour-state">STEADY</span>
          </div>
          <div class="line-stats">
            <div class="status-row">
              <span class="status-key">Integrity</span>
              <span class="status-val" id="line-integrity-val">100%</span>
            </div>
            <div class="status-row">
              <span class="status-key">Morale</span>
              <span class="status-val" id="line-morale-val">Resolute</span>
            </div>
          </div>
        </div>
      </aside>

      <!-- CENTER: Narrative + Drill + Actions -->
      <section class="center-column">
        <div class="narrative-scroll" id="narrative-scroll"></div>

        <div class="battle-panorama" id="panorama" data-volley="1" data-drill="present">
          <!-- French strength block (left) -->
          <div class="strength-block block-french" id="block-french">
            <div class="block-fill" id="french-fill"></div>
            <div class="block-label">FRENCH</div>
          </div>

          <!-- Gap (center) -->
          <div class="pano-gap" id="pano-gap">
            <div class="pano-range">
              <span class="pano-range-val" id="pano-range-val">120</span>
              <span class="pano-range-unit">PACES</span>
            </div>
            <div class="volley-streaks" id="volley-streaks"></div>
          </div>

          <!-- Austrian strength block (right) -->
          <div class="strength-block block-austrian" id="block-austrian">
            <div class="block-fill" id="austrian-fill"></div>
            <div class="block-label">AUSTRIAN</div>
          </div>
        </div>

        <div class="load-animation" id="load-animation" style="display:none;"></div>

        <div class="morale-changes" id="morale-changes"></div>

        <div class="actions-panel" id="actions-panel">
          <!-- Drill step indicator -->
          <div class="drill-indicator" id="drill-indicator">
            <div class="drill-step" data-step="load">LOAD</div>
            <div class="drill-arrow">&rarr;</div>
            <div class="drill-step" data-step="present">PRESENT</div>
            <div class="drill-arrow">&rarr;</div>
            <div class="drill-step" data-step="fire">FIRE</div>
            <div class="drill-arrow">&rarr;</div>
            <div class="drill-step" data-step="endure">ENDURE</div>
          </div>
          <div class="actions-grid" id="actions-grid"></div>
        </div>
      </section>

      <!-- RIGHT: The Enemy -->
      <aside class="panel panel-right" id="enemy-panel">
        <h2>The Enemy</h2>
        <div class="status-row">
          <span class="status-key">Range</span>
          <span class="status-val" id="enemy-range">280 paces</span>
        </div>
        <div class="status-row">
          <span class="status-key">Quality</span>
          <span class="status-val" id="enemy-quality">Line Infantry</span>
        </div>
        <div class="status-row">
          <span class="status-key">Strength</span>
          <span class="status-val" id="enemy-strength">Full Strength</span>
        </div>
        <div class="status-row">
          <span class="status-key">Posture</span>
          <span class="status-val" id="enemy-morale">Advancing</span>
        </div>
        <div class="status-row">
          <span class="status-key">Line Integrity</span>
          <span class="status-val" id="enemy-integrity">100%</span>
        </div>
        <div class="status-row">
          <span class="status-key">Morale</span>
          <span class="status-val" id="enemy-morale-state">Resolute</span>
        </div>
        <div class="enemy-detail" id="enemy-detail">
          <div class="status-row">
            <span class="status-key">Artillery</span>
            <span class="status-val" id="enemy-arty">Active</span>
          </div>
          <div class="status-row">
            <span class="status-key">Cavalry</span>
            <span class="status-val" id="enemy-cav">None sighted</span>
          </div>
        </div>
        <!-- Melee Opponent Card (shown during Phase 3) -->
        <div class="melee-opponent-card" id="melee-opponent-card" style="display:none;">
          <h3>Current Opponent</h3>
          <div class="opp-name" id="opp-name"></div>
          <div class="opp-desc" id="opp-desc"></div>
          <div class="meter-group opp-health-group">
            <div class="meter-header">
              <span class="meter-label">Health</span>
              <span class="meter-value"><span id="opp-health-num">0</span></span>
            </div>
            <div class="meter-track"><div class="meter-fill health-fill" id="opp-health-bar"></div></div>
          </div>
          <div class="meter-group opp-fatigue-group">
            <div class="meter-header">
              <span class="meter-label">Fatigue</span>
              <span class="meter-value"><span id="opp-fatigue-num">0</span></span>
            </div>
            <div class="meter-track"><div class="meter-fill fatigue-fill" id="opp-fatigue-bar"></div></div>
          </div>
          <div class="opp-statuses" id="opp-statuses"></div>
          <div class="status-row">
            <span class="status-key">Opponent</span>
            <span class="status-val" id="opp-counter">1 / 4</span>
          </div>
          <div class="status-row">
            <span class="status-key">Kills</span>
            <span class="status-val" id="melee-kills">0</span>
          </div>
        </div>
      </aside>
      <!-- Intro Screen -->
      <div class="intro-container" id="intro-container">
        <button class="intro-mute" id="btn-intro-mute" title="Toggle Music">&#9835;</button>
        <img src="/assets/mascot.png" alt="Mascot" class="intro-mascot" id="intro-mascot"/>
        <h1 class="intro-title">The Little Soldier</h1>
        <p class="intro-subtitle">A Napoleonic Saga</p>

        <!-- Step 1: Name -->
        <div class="intro-step" id="intro-name-step">
          <label class="intro-label" for="intro-name-input">What is your name, soldier?</label>
          <input type="text" id="intro-name-input" class="intro-input" placeholder="Enter your name..." maxlength="24" autocomplete="off"/>
          <button class="intro-btn" id="btn-intro-confirm">I am ready</button>
        </div>

        <!-- Step 2: Character sheet -->
        <div class="intro-step" id="intro-stats-step" style="display:none;">
          <h2 class="intro-sheet-title">Character Sheet</h2>
          <p class="intro-player-name" id="intro-player-name"></p>
          <div class="intro-rank-select" id="intro-rank-select">
            <span class="intro-rank-label">Rank</span>
            <button class="intro-rank-btn active" data-rank="private">Private</button>
            <button class="intro-rank-btn" data-rank="officer">Officer</button>
          </div>
          <div class="intro-stats" id="intro-stats"></div>
          <button class="intro-btn intro-btn-begin" id="btn-intro-begin">Begin</button>
        </div>
      </div>

      <!-- Phase 2: Storybook/Parchment Container -->
      <div class="storybook-container" id="storybook-container">
        <div class="parchment-page">
          <div class="parchment-header">
            <span class="parchment-phase" id="parchment-phase">THE BATTERY</span>
            <span class="parchment-encounter" id="parchment-encounter"></span>
          </div>
          <div class="parchment-narrative" id="parchment-narrative"></div>
          <div class="parchment-status" id="parchment-status"></div>
          <div class="parchment-choices" id="parchment-choices"></div>
        </div>
      </div>

      <!-- Camp Container -->
      <div class="camp-container" id="camp-container">
        <div class="camp-header" id="camp-header">
          <span class="camp-location" id="camp-location">Camp</span>
          <div class="camp-time-bar">
            <span class="camp-time-label">Time</span>
            <div class="camp-time-track"><div class="camp-time-fill" id="camp-time-fill"></div></div>
          </div>
        </div>
        <div class="camp-body">
          <aside class="camp-column camp-col-activities">
            <h3>Activities</h3>
            <div class="camp-activities-grid" id="camp-activities-grid"></div>
            <button class="btn-march" id="btn-march" style="display:none;">March to Battle</button>
          </aside>
          <section class="camp-column camp-col-status">
            <h3>Status</h3>
            <div class="camp-player-stats" id="camp-player-stats"></div>
            <h3>Opinions</h3>
            <div class="camp-npc-list" id="camp-npc-list"></div>
          </section>
          <aside class="camp-column camp-col-info">
            <h3>Conditions</h3>
            <div class="camp-conditions" id="camp-conditions"></div>
            <h3>Journal</h3>
            <div class="camp-narrative" id="camp-narrative"></div>
          </aside>
        </div>
        <div class="camp-event-overlay" id="camp-event-overlay" style="display:none;">
          <div class="camp-event-content" id="camp-event-content"></div>
        </div>
      </div>

      <!-- Phase 3: Melee Arena Container -->
      <div class="melee-arena" id="melee-arena">
        <!-- Scene: fighters dominate, enemy info floats near enemy -->
        <div class="duel-scene" id="duel-display">
          <!-- Round counter overlay -->
          <div class="arena-header">
            <span class="arena-round" id="arena-round">Round 1 / 12</span>
            <span class="arena-kills" id="arena-kills">Kills: 0</span>
          </div>

          <!-- Fighters — large, centered -->
          <div class="duel-fighters">
            <div class="duel-combatant duel-player" id="duel-player">
              <img src="/assets/player-french.png" alt="You" class="duel-img">
            </div>
            <div class="duel-combatant duel-opponent" id="duel-opponent">
              <div class="enemy-hud">
                <div class="combatant-name" id="arena-opp-name">A frightened conscript</div>
                <div class="combatant-meters">
                  <div class="arena-meter">
                    <span class="arena-meter-label">HP</span>
                    <div class="arena-meter-track"><div class="arena-meter-fill health-fill" id="arena-opp-hp-bar"></div></div>
                    <span class="arena-meter-val" id="arena-opp-hp-val">60</span>
                  </div>
                  <div class="arena-meter">
                    <span class="arena-meter-label">FT</span>
                    <div class="arena-meter-track"><div class="arena-meter-fill fatigue-fill" id="arena-opp-ft-bar"></div></div>
                    <span class="arena-meter-val" id="arena-opp-ft-val">50</span>
                  </div>
                </div>
                <div class="combatant-statuses" id="arena-opp-statuses"></div>
                <div class="combatant-desc" id="arena-opp-desc"></div>
                <div class="arena-opp-counter" id="arena-opp-counter">Opponent 1 / 3</div>
              </div>
              <img src="/assets/enemy-austrian.png" alt="Opponent" class="duel-img">
            </div>
          </div>
        </div>

        <!-- Narrative feed -->
        <div class="arena-narrative" id="arena-narrative"></div>

        <!-- Player HUD: stats | portrait | actions -->
        <div class="player-hud">
          <div class="hud-stats">
            <div class="combatant-name" id="arena-player-name">You</div>
            <div class="combatant-meters">
              <div class="arena-meter">
                <span class="arena-meter-label">HP</span>
                <div class="arena-meter-track"><div class="arena-meter-fill health-fill" id="arena-player-hp-bar"></div></div>
                <span class="arena-meter-val" id="arena-player-hp-val">100</span>
              </div>
              <div class="arena-meter">
                <span class="arena-meter-label">FT</span>
                <div class="arena-meter-track"><div class="arena-meter-fill fatigue-fill" id="arena-player-ft-bar"></div></div>
                <span class="arena-meter-val" id="arena-player-ft-val">100</span>
              </div>
              <div class="arena-meter">
                <span class="arena-meter-label">MR</span>
                <div class="arena-meter-track"><div class="arena-meter-fill morale-fill" id="arena-player-mr-bar"></div></div>
                <span class="arena-meter-val" id="arena-player-mr-val">100</span>
              </div>
            </div>
            <div class="combatant-stance" id="arena-player-stance">BALANCED</div>
            <div class="combatant-statuses" id="arena-player-statuses"></div>
          </div>

          <div class="hud-portrait">
            <div class="portrait-name" id="portrait-name"></div>
            <div class="portrait-frame">
              <div class="portrait-placeholder"></div>
            </div>
          </div>

          <div class="hud-actions" id="arena-actions">
            <div class="arena-actions-grid" id="arena-actions-grid"></div>
          </div>
        </div>
      </div>
    </main>

    <!-- Character/Inventory overlay -->
    <div class="char-overlay" id="char-overlay" style="display:none;">
      <div class="char-panel">
        <button class="char-close" id="btn-char-close">&times;</button>
        <h2>Character</h2>
        <div class="char-stats" id="char-stats"></div>
        <h3>Equipment</h3>
        <div class="char-inventory" id="char-inventory"></div>
      </div>
    </div>

    <!-- Journal Overlay -->
    <div class="journal-overlay" id="journal-overlay" style="display:none;">
      <div class="journal-panel">
        <button class="journal-close" id="btn-journal-close">&times;</button>
        <h2>Battle Journal</h2>
        <div class="journal-scroll" id="journal-scroll"></div>
      </div>
    </div>

    <!-- Battle Over -->
    <div class="battle-over-overlay" id="battle-over" style="display:none;">
      <div class="battle-over-content">
        <h2 id="battle-over-title">Battle Over</h2>
        <p id="battle-over-text"></p>
        <div class="battle-stats" id="battle-stats"></div>
        <button class="btn-restart" id="btn-continue-camp" data-action="camp" style="display:none;">Continue to Camp</button>
        <button class="btn-restart" id="btn-restart" data-action="restart">Fight Again</button>
      </div>
    </div>

    <!-- Dev Tools Overlay -->
    <div class="dev-overlay" id="dev-overlay" style="display:none;">
      <div class="dev-panel">
        <button class="dev-close" id="btn-dev-close">&times;</button>
        <h2 class="dev-title">Dev Tools</h2>
        <div class="dev-tabs" id="dev-tabs"></div>
        <div class="dev-content" id="dev-content"></div>
      </div>
    </div>

    <!-- Mascot -->
    <div class="mascot-container" id="mascot">
      <img src="/assets/mascot.png" alt="Mascot" class="mascot-img"/>
      <div class="mascot-bubble" id="mascot-bubble">Vive la France!</div>
    </div>
  </div>

  <script type="module" src="/src/app.ts"></script>
</body>
</html>
